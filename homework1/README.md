# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ 1: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ Control Flow Graph (CFG)

## –¶–µ–ª—å
–ù–∞—É—á–∏—Ç—å—Å—è –∏–∑–≤–ª–µ–∫–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (IR) –∏–∑ Go –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ –∏ —Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ –ø–æ—Ç–æ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ Go –ø—Ä–æ–≥—Ä–∞–º–º.

## ‚ö†Ô∏è –í–∞–∂–Ω–æ
–í–µ—Å—å –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –æ–±—â–µ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ: `../internal/cfg/`
–≠—Ç–æ –∑–∞–¥–∞–Ω–∏–µ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç –º–æ–¥—É–ª—å CFG –∞–Ω–∞–ª–∏–∑–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç—è—Ö –∫—É—Ä—Å–∞.

## –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã

### Control Flow Graph (CFG)
CFG - —ç—Ç–æ –≥—Ä–∞—Ñ, –≥–¥–µ:
- **–£–∑–ª—ã (nodes)** - –±–∞–∑–æ–≤—ã–µ –±–ª–æ–∫–∏ (sequences of instructions without jumps)
- **–†—ë–±—Ä–∞ (edges)** - –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏
- **Entry node** - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ —Ñ—É–Ω–∫—Ü–∏—é
- **Exit nodes** - —Ç–æ—á–∫–∏ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏

### Go SSA IR
Go –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç SSA (Static Single Assignment) –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç `golang.org/x/tools/go/ssa`.

## –ó–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1.1: –ò–∑—É—á–µ–Ω–∏–µ Go SSA
–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è SSA –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è:

```go
// –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
func analyzeFunction(source string, funcName string) (*ssa.Function, error) {
    // 1. –ü–∞—Ä—Å–∏–Ω–≥ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
    // 2. –°–æ–∑–¥–∞–Ω–∏–µ SSA –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è  
    // 3. –ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ –∏–º–µ–Ω–∏
    // 4. –í–æ–∑–≤—Ä–∞—Ç SSA —Ñ—É–Ω–∫—Ü–∏–∏
}
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–∫–µ—Ç `golang.org/x/tools/go/ssa`
- –ù–∞—É—á–∏—Ç–µ—Å—å –ø–æ–ª—É—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞–∑–æ–≤–æ–≥–æ –±–ª–æ–∫–∞
- –í—ã–≤–µ–¥–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–ª–æ–∫–∞—Ö –∏ –∏—Ö —Å–≤—è–∑—è—Ö

### –ó–∞–¥–∞–Ω–∏–µ 1.2: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ CFG –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
–†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ CFG –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π —Å —É—Å–ª–æ–≤–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏:

```go
// –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

func simpleIf(x int) int {
    if x > 0 {
        return x * 2
    }
    return 0
}

func ifElse(x int) int {
    if x > 0 {
        return x * 2
    } else {
        return x * -1
    }
    return 0
}

func nestedIf(x, y int) int {
    if x > 0 {
        if y > 0 {
            return x + y
        }
        return x
    }
    return 0
}
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ CFG:**
```go
type BasicBlock struct {
    ID           int
    Instructions []ssa.Instruction
    Successors   []*BasicBlock
    Predecessors []*BasicBlock
}

type CFG struct {
    Entry  *BasicBlock
    Blocks []*BasicBlock
    Exit   *BasicBlock
}
```

### –ó–∞–¥–∞–Ω–∏–µ 1.3: –ê–Ω–∞–ª–∏–∑ —Ü–∏–∫–ª–æ–≤ –≤ CFG
–î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ü–∏–∫–ª–æ–≤ –∏ –ø–æ—Å—Ç—Ä–æ–π—Ç–µ CFG –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π —Å —Ü–∏–∫–ª–∞–º–∏:

```go
func simpleLoop(n int) int {
    sum := 0
    for i := 0; i < n; i++ {
        sum += i
    }
    return sum
}

func whileLoop(x int) int {
    for x > 0 {
        x = x - 1
    }
    return x
}

func nestedLoops(n, m int) int {
    sum := 0
    for i := 0; i < n; i++ {
        for j := 0; j < m; j++ {
            sum += i * j
        }
    }
    return sum
}
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ back edges (—Ä—ë–±—Ä–∞, —Å–æ–∑–¥–∞—é—â–∏–µ —Ü–∏–∫–ª—ã)
- –ù–∞–π–¥–∏—Ç–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã –≤ –≥—Ä–∞—Ñ–µ
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ loop headers –∏ exit blocks

### –ó–∞–¥–∞–Ω–∏–µ 1.4: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è CFG *(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)*
üéØ **–≠—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** - —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∞–ª–ª—ã –∏–ª–∏ –≤–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ!

–°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ CFG –≤ —Ñ–æ—Ä–º–∞—Ç DOT (Graphviz):

```go
func (cfg *CFG) ExportToDot() string {
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DOT –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
}
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ö–∞–∂–¥—ã–π –±–∞–∑–æ–≤—ã–π –±–ª–æ–∫ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–≤–æ–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –†—ë–±—Ä–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω—ã (true/false –¥–ª—è —É—Å–ª–æ–≤–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤)
- Back edges –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–¥–µ–ª–µ–Ω—ã –¥—Ä—É–≥–∏–º —Ü–≤–µ—Ç–æ–º

## –ß—Ç–æ —Å–¥–∞–≤–∞—Ç—å

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –æ–±—â–µ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ:**
- `../internal/cfg/types.go` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ –º–µ—Ç–æ–¥—ã –¥–ª—è BasicBlock –∏ CFG
- `../internal/cfg/builder.go` - —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–∞—Ä—Å–∏–Ω–≥ SSA –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ CFG  
- `../internal/cfg/visualizer.go` - *(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)* –¥–æ–±–∞–≤—å—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –≤ DOT –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**–í –ø–∞–ø–∫–µ homework1:**
- `main.go` - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ (—É–∂–µ —Å–æ–∑–¥–∞–Ω–∞)
- `examples/test_functions.go` - —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—É–∂–µ —Å–æ–∑–¥–∞–Ω—ã)

```
homework1/
‚îú‚îÄ‚îÄ examples/
‚îÇ   ‚îî‚îÄ‚îÄ test_functions.go    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è CFG
‚îú‚îÄ‚îÄ main.go                  // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç internal/cfg)
‚îú‚îÄ‚îÄ REPORT.md                // –í–∞—à –æ—Ç—á—ë—Ç
‚îî‚îÄ‚îÄ README.md
```

## –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
- [golang.org/x/tools/go/ssa](https://pkg.go.dev/golang.org/x/tools/go/ssa)
- [SSA —Ñ–æ—Ä–º–∞ –≤ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞—Ö](https://en.wikipedia.org/wiki/Static_single_assignment_form)
- [Control Flow Analysis](https://en.wikipedia.org/wiki/Control-flow_analysis)